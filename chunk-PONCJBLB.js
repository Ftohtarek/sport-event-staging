import{a as o}from"./chunk-EUTN2ONZ.js";import{a as S}from"./chunk-M3I5XXFR.js";import{a as c}from"./chunk-62E7ZVO7.js";import{a as l}from"./chunk-CL6Z4AWC.js";import{b as i}from"./chunk-3V2DYMXD.js";import{b as d,j as f}from"./chunk-YZY77BDX.js";import{O as r,S as m,X as h}from"./chunk-2ZTQTHCR.js";var u=class{constructor(s){this.http=s,this.SERVER_URL=l.baseUrl}register(s){return this.http.post(`${this.SERVER_URL}client/register`,s,{headers:{withLoader:"true"}})}verify(s){return this.http.post(`${this.SERVER_URL}client/verify`,s,{headers:{withLoader:"true"}})}resenCode(s){return this.http.post(`${this.SERVER_URL}client/resendCode`,s,{headers:{withLoader:"true"}})}login(s){return this.http.post(`${this.SERVER_URL}client/login`,s,{headers:{withLoader:"true"}})}forgetPassword(s){return this.http.post(`${this.SERVER_URL}client/forgotPassword`,s,{headers:{withLoader:"true"}})}verifyForgetPassword(s){return this.http.post(`${this.SERVER_URL}client/verifyForgetPassword`,s,{headers:{withLoader:"true"}})}resetPassword(s,a){return this.http.post(`${this.SERVER_URL}client/resetPassword`,s,{headers:{withLoader:"true",Authorization:a}})}};var O=(()=>{let s=class s extends u{constructor(e,t){super(e),this.userState=t,this.authSession=new g,this.router=S.get(f)}register(e){return super.register(e).pipe(r(t=>{[200,201].includes(t.status)&&(this.authSession.openOtpSession(e,"regsiter"),o({message:t.msg}),this.router.navigate([i.auth.otp]))}))}verifyOtp(e){return this.authSession.session.otp_type=="regsiter"?super.verify({code:e,email:this.authSession.session.otp_session?.email}).pipe(r(t=>{t.status==200&&(o({message:t.msg}),this.router.navigate([i.auth.login]))})):super.verifyForgetPassword({code:e,email:this.authSession.session.otp_session?.email}).pipe(r(t=>{t.status==200&&(this.authSession.openSession("user",t.data),o({message:t.msg}),this.router.navigate([i.auth.newPassword]))}))}resenCode(){return super.resenCode({email:this.authSession.session.otp_session?.email}).pipe(r(e=>e.status==200?o({message:e.msg}):null))}login(e){return super.login(e).pipe(r(t=>{if([200,201].includes(t.status)){o({message:t.msg}),this.userState.updateUser(t.data);let p=this.authSession.getSession("returnUrl");p?this.router.navigate([p]):this.router.navigate([i.home])}}))}forgetPassword(e){return super.forgetPassword(e).pipe(r(t=>{t.status==200&&(this.authSession.openOtpSession(e,"forget_password"),this.router.navigate([i.auth.otp]))}))}newPassword(e){let t=this.authSession.getSession("user")?.token;return super.resetPassword(e,t).pipe(r(p=>{p.status==200&&(this.authSession.session.otp_session={password:e.password},o({message:p.msg}),this.router.navigate([i.auth.login]))}))}};s.\u0275fac=function(t){return new(t||s)(h(d),h(c))},s.\u0275prov=m({token:s,factory:s.\u0275fac,providedIn:"root"});let n=s;return n})(),g=class{constructor(){this.session=JSON.parse(sessionStorage.getItem("authSession")),this.session||(this.session={otp_session:void 0,otp_type:void 0})}openOtpSession(s,a){this.session={otp_session:s,otp_type:a},sessionStorage.setItem("authSession",JSON.stringify(this.session))}openSession(s,a){return sessionStorage.setItem(s,JSON.stringify(a))}getSession(s){return JSON.parse(sessionStorage.getItem(s)||"")}close(s){sessionStorage.removeItem(s)}};export{O as a};
